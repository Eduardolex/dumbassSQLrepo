<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebTable</title>
</head>
<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        box-sizing: border-box;
    }

    .login {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 50px;
    }


    .invis {
        visibility: hidden;
        z-index: -100;
    }

    .fade-out {
        animation: fadeOut 2s ease forwards;
    }

    @keyframes fadeOut {
        from {
            opacity: 1;
        }

        to {
            opacity: 0;
        }
    }

    table {
        border-collapse: collapse;
        width: 100%;
        max-width: 600px;
        margin-top: 20px;
        font-family: Arial, sans-serif;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
    }

    th, td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }

    th {
        background-color: #4a90a4;
        color: white;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 14px;
        letter-spacing: 0.5px;
    }

    td {
        background-color: #fff;
        color: #333;
    }

    tr:hover td {
        background-color: #f5f5f5;
    }

    tr:last-child td {
        border-bottom: none;
    }
    .login{
        border: 2px solid black;
        border-radius: 10px;
        padding: 10px;
        box-shadow: #333 2px 2px 5px;
        max-width: 240px;
        justify-content: center;
        align-items: center;
    }

    .login button {
        padding: 12px 40px;
        margin-top: 15px;
        font-size: 15px;
        font-weight: 600;
        color: #667eea;
        background: transparent;
        border: 2px solid #667eea;
        border-radius: 6px;
        cursor: pointer;
        position: relative;
        overflow: hidden;
        z-index: 1;
        transition: color 0.4s ease;
    }

    .login button::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 0%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        z-index: -1;
        transition: width 0.4s ease;
    }

    .login button:hover {
        color: white;
    }

    .login button:hover::before {
        width: 100%;
    }

    .login button:active {
        transform: scale(0.98);
    }
    /* From Uiverse.io by Satwinder04 */
    .input-container {
        position: relative;
        margin: 15px auto;
        width: 200px;
    }

    .input-container input {
        font-size: 18px;
        width: 100%;
        border: none;
        border-bottom: 2px solid #ccc;
        padding: 5px 0;
        background-color: transparent;
        outline: none;
    }

    .input-container .label {
        position: absolute;
        top: 0;
        left: 0;
        color: #ccc;
        transition: all 0.3s ease;
        pointer-events: none;
    }

    .input-container input:focus ~ .label,
    .input-container input:valid ~ .label {
        top: -20px;
        font-size: 14px;
        color: #667eea;
    }

    .input-container .underline {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 2px;
        width: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        transform: scaleX(0);
        transition: all 0.3s ease;
    }

    .input-container input:focus ~ .underline,
    .input-container input:valid ~ .underline {
        transform: scaleX(1);
    }
    td {
        border: 2px solid black;
        border-radius: 10px;
    }

    .table-container {
        max-width: 90%;
        margin: 20px auto;
        overflow-x: auto;
    }
</style>

<body>
    <div class="login">
        <div class="input-container inputs">
            <input type="text" id="email" required>
            <label for="email" class="label">Email</label>
            <div class="underline"></div>
        </div>
        <div class="input-container inputs">
            <input type="password" id="password" required>
            <label for="password" class="label">Password</label>
            <div class="underline"></div>
        </div>
        <button class="inputs" onclick="table()" onclick="login()">Login</button>
        <p id="message"></p>
    </div>


<div class="table-container">
<table>
    <tr>
        <th id="firstname">Firstname</th>
        <th id="lastname">Lastname</th>
        <th id="column1">Column1</th>
        <th id="column2">Column2</th>
        <th id="column3">Column3</th>
        <th id="column4">Column4</th>
        <th id="column5">Column5</th>
        <th id="column6">Column6</th>
        <th id="column7">Column7</th>
        <th id="column8">Column8</th>
        <th id="column9">Column9</th>
        <th id="column10">Column10</th>
        <th id="column11">Column11</th>
        <th id="column12">Column12</th>
    </tr>
    <tr>
        <td id="1"></td>
        <td id="2"></td>
        <td id="3"></td>
        <td id="4"></td>
        <td id="5"></td>
        <td id="6"></td>
        <td id="7"></td>
        <td id="8"></td>
        <td id="9"></td>
        <td id="10"></td>
        <td id="11"></td>
        <td id="12"></td>
        <td id="13"></td>
        <td id="14"></td>
    </tr>
</table>
</div>


</body>
<script>
    let loggedInEmail = null;

    async function login() {
        const email = document.getElementById('email').value
        const password = document.getElementById('password').value

        const res = await fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({email, password})
        })
        const data = await res.json()

        if (data.ok) {
            loggedInEmail = email;
            document.getElementById('message').innerText = 'Login successful!'
            document.getElementById('message').classList.add("fade-out")
            console.log('Login successful:', data)
            document.querySelectorAll(".invis").forEach(el => {
                el.classList.remove("invis");
            });

            document.querySelectorAll('.inputs').forEach(el => {
                el.classList.add("invis");
            });
            document.querySelectorAll('.login').forEach(el => {
                el.classList.add("invis");
            });


        } else {
            document.getElementById('message').innerText = data.error
        }

    }
    email.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            password.focus();
        }
    });

    password.addEventListener('keydown', function (event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            login();
            table();
        }
    });
    

async function topup() {
    const amount = 5;

    const res = await fetch('/topup', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email: loggedInEmail, amount })
    });

    const data = await res.json();

    if (data.ok) {
        document.getElementById('credits').innerText = `Credits: ${data.user.credits}`;
    } else {
        document.getElementById('message').innerText = data.error;
    }
}
async function table() {
  const res = await fetch('/table', { method: 'GET' });

  // optional: handle non-2xx responses
  if (!res.ok) {
    document.getElementById('message').innerText = `Request failed: ${res.status}`;
    return;
  }

  const data = await res.json();
  console.log(data);

  if (!data.ok) {
    document.getElementById('message').innerText = data.error || 'Unknown error';
    return;
  }

  const rows = data.table; // <- THIS is your array of rows
  if (!Array.isArray(rows) || rows.length === 0) {
    document.getElementById('message').innerText = 'No rows returned';
    return;
  }

  // Fill the first row into elements with ids "1"..."14"
  const first = rows[0];
  document.getElementById('1').innerText = first.firstname ?? '';
  document.getElementById('2').innerText = first.lastname ?? '';
  document.getElementById('3').innerText = first.column1 ?? '';
  document.getElementById('4').innerText = first.column2 ?? '';
  document.getElementById('5').innerText = first.column3 ?? '';
  document.getElementById('6').innerText = first.column4 ?? '';
  document.getElementById('7').innerText = first.column5 ?? '';
  document.getElementById('8').innerText = first.column6 ?? '';
  document.getElementById('9').innerText = first.column7 ?? '';
  document.getElementById('10').innerText = first.column8 ?? '';
  document.getElementById('11').innerText = first.column9 ?? '';
  document.getElementById('12').innerText = first.column10 ?? '';
  document.getElementById('13').innerText = first.column11 ?? '';
  document.getElementById('14').innerText = first.column12 ?? '';

  // Append all rows into the table body
  const tableEl = document.querySelector('table');
  // ideally target tbody: document.querySelector('table tbody')
  for (let i = 1; i < rows.length; i++) {
    const r = rows[i];
    const tr = document.createElement('tr');

    const values = [
      r.firstname, r.lastname,
      r.column1, r.column2, r.column3, r.column4, r.column5, r.column6,
      r.column7, r.column8, r.column9, r.column10, r.column11, r.column12
    ];

    for (const v of values) {
      const td = document.createElement('td');
      td.innerText = v ?? '';
      tr.appendChild(td);
    }

    tableEl.appendChild(tr);
  }
}


</script>

</html>
